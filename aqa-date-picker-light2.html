<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../iron-validator-behavior/iron-validator-behavior.html">

<dom-module id="aqa-date-picker-light2">
    <template>
        <style is="custom-style">
            .main {
                border: 1px solid #CCC;
                border-radius: 5px;
                /* background-color: greenyellow; */
            }

            .sectionHeader {
                display: flex;
                padding: 10px;
                justify-content: space-between;
            }


            .sectionHeader > .right {
                width: 50%;
                display: flex;
                justify-content: flex-end;
            }

            .sectionHeader > .right > div {
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 30px;
                width:30px;
                height: 30px;
                cursor: pointer;
            }

            .sectionHeader > .right > div:hover {
                background-color: #EEE;
            }

            .sectionHeader > .right > div:active {
                background-color: #CCC;
            }




            .sectionDayOfWeek {
                display: flex;
                justify-content: space-between;
                
            }

            .dayOfWeek {
                width: 14.285%;
                height: 35px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #888;
                /* background-color:green;
                border: 1px solid #ccc;
                box-sizing: border-box; */
            }



            .sectionDayOfMonth {
                display: flex;
                flex-wrap: wrap;
            }

            .dayOfMonth {
                width: 14.285%;
                height: 35px;
                display: flex;
                align-items: center;
                justify-content: center;
                /* background-color:#3399ff;
                border: 1px solid #ccc;
                box-sizing: border-box; */
            }

            .dayOfMonth > div {
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 30px;
                width:30px;
                height: 30px;
                cursor: pointer;
            }

            .dayOfMonth > div:hover {
                background-color: #CCC; 
            }
            
            .dayOfMonth > div[day-select] {
                background-color: #3399FF;
                color: #FFF;
            }

            


            
          

        </style>


        <div id="calendar" class="main">
            <div class="sectionHeader">
                <div>
                    [[_showMonth(datePage.month)]] [[_showYear(datePage.year)]]
                </div>
                <div class="right">
                    <div on-click="_previousMonth">
                        <div>&#60;</div>
                    </div>
                    <div on-click="_nextMonth">
                        <div>&#62;</div>
                    </div>
                </div>
            </div>
            <div class="sectionDayOfWeek">
                <template is="dom-repeat" items="[[daysOfWeek]]">
                    <div class="dayOfWeek">
                        <div>[[item]]</div>
                    </div>
                </template>
            </div>
            <div class="sectionDayOfMonth">
                <template is="dom-repeat" items="[[days]]">
                    <div class="dayOfMonth" on-click="_selectDay">
                        <div day-select$="[[item.daySelect]]">
                            <div>[[item.day]]</div>
                        </div>
                    </div>
                </template>
               
            </div>
        </div>
    </template>

    <script>

        class AqaDatePickerLight2 extends Polymer.Element {
            static get is() { return 'aqa-date-picker-light2'; }
            static get properties() {
                return {
                    value: {
                        type: String,
                        value: '2018-08-06',
                        observer: '_valueChanged'
                    },
                    date: {
                        type: Object,
                        value: {}
                    },
                    datePage: {
                        type: Object,
                        value: {}
                    },
                    daysOfWeek: {
                        type: Array,
                        value: ['อา', 'จ', 'อ', 'พ', 'พฤ', 'ศ', 'ส']
                    },
                    // months: {
                    //     type: Array,
                    //     value: ['ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.', 'ก.ค.', 'ส.ค.', 'ก.ย', 'ต.ค.', 'พ.ย.', 'ธ.ค.']
                    // },
                    days: {
                        type: Array,
                        value: []
                    }
                };
            }
            constructor() {
                super()
            }

            _valueChanged(val){
                var date;
                if(val==""){
                    date = new Date()
                }else {
                    date = new Date(val)
                }
                

               

                // เก็บสถานะวันที่
                this.date = {
                    day: date.getDate(),
                    month: date.getMonth(),
                    year: date.getFullYear()
                }
                
                this._renderCalendar(this.date)
                
                
            }

            _renderCalendar(date){
                var days = []
                console.log(date)

                // เก็บสถานะที่แสดงอยู่
                this.datePage = {
                    month: date.month,
                    year: date.year
                }
                
                // หาวันเริ่มต้นของเดือน เช่น จันทร์ อังคาร
                var fristDayOfWeek = new Date(date.year, date.month, 1).getDay()
                console.log(fristDayOfWeek)
                for(var i=0; i<fristDayOfWeek; i++){
                    // เพิ่งช่องว่างก่อนเริ่มวันแรก
                    days.push({})
                }

                // หาจำนวนวันทั้งหมดของเดือน
                var countDaysOfMonth = new Date(date.year, date.month, 0).getDate()
                for(var i=0; i<countDaysOfMonth; i++){
                    // เพิ่มวันให้เต็ม
                    var day = i+1
                    days.push({
                        day:day,
                        // สร้างวันที่ string "xxxx-xx-xx"
                        date:date.year+"-"+("0"+(date.month+1)).slice(-2)+"-"+("0"+day).slice(-2),
                        daySelect:(this.date.year+"-"+this.date.month+"-"+this.date.day)==(this.datePage.year+"-"+this.datePage.month+"-"+day)
                    })
                }

                //console.log(fristDayOfWeek,countDaysOfMonth)
                //console.log(days)
                this.days = days

                
            }

            // เมื่อกดเลือกวันที่
            _selectDay(e) {
                this.value = e.model.item.date
            }

            _showMonth(month) {
                var monthLabels = ["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"]
                return monthLabels[month]
            }

            _showYear(year) {
                return year+543
            }

            _nextMonth() {
                var m = this.datePage.month+1
                var y = this.datePage.year

                if(m==12){
                    m = 0
                    y = y+1
                }

                this._renderCalendar({
                    month: m,
                    year: y
                })
            }

            _previousMonth(){
                var m = this.datePage.month-1
                var y = this.datePage.year

                if(m==-1){
                    m = 11
                    y = y-1
                }
                this._renderCalendar({
                    month: m,
                    year: y
                })
            }





            // _countDayInMonth(month, year) {
            //     return new Date(year, month, 0).getDate();
            // }

            // _getFristDayOfWeek(month, year) {
            //     return new Date(year, month, 1).getDay();
            // }

        }

        window.customElements.define(AqaDatePickerLight2.is, AqaDatePickerLight2);
    </script>
</dom-module>